# 游戏服务端之AOI概述

2013年12月29日 00:27:53

阅读数：5619

AOI(Area Of Interest)，中文就是感兴趣区域。通俗一点说，感兴趣区域就是玩家在场景实时看到的区域；也就是AOI会随着英雄的移动改变而改变。

一般在游戏的中，游戏的世界都是由各种场景组成，场景中有着各种各样的Obj(英雄、怪物、NPC和掉落物品等等)。当英雄在移动的时候，玩家需要看到其它在自己视野内玩家的英雄；需要看到在自己视野内的怪物；需要看到打BOSS掉落的物品；……。

有人会说：这还不简单，将场景内所有Obj的信息实时广播给其它玩家，这不就行了吗？！

当然这样的做法对于一些类似竞技场、擂台这样的玩法确实是一个最优的解决方法。毕竟在这个场景只有你们两个人。但是你能想像一下一个场景有几百个英雄，甚至几千个英雄时候（还不包括其它的Obj），它们每移动一步都向你的广播一下信息。下面用公式计算一下，假设场景有1000个英雄。每个英雄都向其它各个英雄广播自己的信息。也就是说一个每个英雄都要处理其它1000个英雄的实时信息（其实是999个，为了方便计算）。这样一来，服务器就需要实时处理一百万条信息了。但是如果服务器有对AOI作处理，玩家的视野大约只有50个英雄（AOI里有50个英雄），那么只需要这50个英雄向自己的英雄发送信息就可以了。那么服务器只需要实时处理2500条信息就可以。效率一下子提高了400倍，而且节约了网络开销。

下面就介绍实际应用中最常用的AOI处理方法--网格法。

这篇博文只是说清楚AOI网格法的原理，为以后写场景管理器的时候作一些理论的铺垫，所以这篇博文不会贴代码。

![img](https://img-blog.csdn.net/20131229005013781?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveWl0b3VoYW4=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

1、首先会将场景划分等大小的网格。
2、当玩家进入到场景的时候（无论是从传送点传送进来，还是飞进来的），会将玩家注册到某个网格，与此同时通过使用观察者模式，将新进来自己的英雄信息通知对这个网格感兴趣的其它英雄。懂Lua的可以看一下观察者模式lua实现：<http://blog.csdn.net/yitouhan/article/details/15028301>
3、与此同时，自己的英雄也有感兴趣的区域（AOI），因为感兴趣是相互的。如红色矩形A，他的感兴趣的区域就是包含它的4个网格；如果A移动到B，那么自己的英雄的感兴趣的区域就是1、2、3、4、5、6、7、8和9了。也就是说当上述区域的Obj发生改变的时候，都要通知自己的英雄。
4、那样要怎样才能快速找到AOI呢？可以从图中看出，这样划分成网格后，就会变成矩阵。我们可以将其保存成二维数组，这样就能在O(1)下定位到AOI了。
5、AOI的大小一般大于等于屏幕坐标大小。如果小于的话，在边缘的Obj将会看不见。（因为你都没有发消息给客户端）。
6、网格划分得太小，对内存开销较大；网格划分得太大，对CPU开销较大，因为由矩形B可以看出，需要将B的信息发到不在B的视野内的其它的Obj（注意这里说的是视野，AOI是那9个格子），大大增加了开销。